---
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }))
}

type Props = CollectionEntry<'blog'>

const post = Astro.props
const { Content } = await post.render()
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <Header />

  <main class="container mx-auto px-4 py-16">
    <article class="prose prose-lg mx-auto">
      <!-- Post Header -->
      <div class="mb-8 border-b pb-8">
        <h1 class="mb-4">{post.data.title}</h1>
        <div class="flex items-center gap-4 text-sm text-gray-600">
          <time>
            {
              post.data.publishDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })
            }
          </time>
          {
            post.data.updatedDate && (
              <span>
                • Updated:{' '}
                {post.data.updatedDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </span>
            )
          }
        </div>
        {
          post.data.tags.length > 0 && (
            <div class="mt-4 flex flex-wrap gap-2">
              {post.data.tags.map((tag) => (
                <span class="rounded-full bg-blue-100 px-3 py-1 text-xs text-blue-700">
                  {tag}
                </span>
              ))}
            </div>
          )
        }
      </div>

      <!-- Post Content -->
      <Content />

      <!-- Back to Blog -->
      <div class="mt-12 border-t pt-8">
        <a href="/blog" class="text-blue-600 hover:underline"> ← Back to Blog </a>
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>

<style is:global>
  /* Custom prose styles */
  .prose {
    max-width: 65ch;
    color: #374151;
  }

  .prose h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }

  .prose h2 {
    font-size: 1.875rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .prose p {
    margin-bottom: 1.5rem;
    line-height: 1.75;
  }

  .prose code {
    background-color: #f3f4f6;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }

  .prose pre {
    background-color: #1f2937;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
  }

  .prose pre code {
    background-color: transparent;
    color: #e5e7eb;
  }
</style>
